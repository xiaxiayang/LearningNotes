### 1.webview 加载为什么慢，如何优化

https://www.jianshu.com/p/0fbd4a57b553

对于一个普通用户来讲，打开一个 WebView 通常会经历以下几个阶段：

- 交互无反馈

- 到达新的页面，页面白屏

- 页面基本框架出现，但是没有数据；页面处于 loading 状态

- 出现所需的数据


![](https://github.com/xiaxiayang/ImagesUsed/blob/master/webview%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.png?raw=true)


### 2.webview 的初始化
 
 当 app 首次打开的时，默认是不初始化浏览器内核的。只有当创建 webview 实例的时候才会去创建 webview 的基础框架
 
 与浏览器不同，app 中打开 webview 的第一步不是建立连接，而是启动化浏览器内核。
 
 而这段时间内， webview 是不存在的，所以后续的建立连接、解析等过程完全被阻塞。
 
 优化思路：
 
 
 1) 全局 webView (额外的内存消耗，容易内存泄漏)
 
 2）客户端代理数据请求 （webview 初始化的同时，app请求数据，页面初始化后。向 app 获取请求的数据）
 

### 3.建立连接

在页面请求的数据返回之前，主要有以下过程耗费时间：

1） dns 

2）连接

3）服务器处理

优化思路：

1）dns 采用和客户端 api 相同的域名

2）同步渲染时如果后端请求时间过长，可以考虑采用chunk编码，将数据放在最后，并优先将静态内容flush


### 4.页面渲染框架

页面在解析到足够多的节点，且所有CSS都加载完成后进行首屏渲染。在此之前，页面保持白屏；在页面完全下载并解析完成之前，页面处于不完整展示状态

通常情况下，CSS不会阻塞HTML的解析，但如果CSS后面有JS，则会阻塞JS的执行直到CSS加载完成（即便JS是内联的脚本），从而间接阻塞HTML的解析

优化思路：

1）CSS的加载会在HTML解析到CSS的标签时开始，所以CSS的标签要尽量靠前。

2）但是，CSS链接下面不能有任何的JS标签（包括很简单的内联JS），否则会阻塞HTML的解析。

3）如果必须要在头部增加内联脚本，一定要放在CSS标签之前。


### WebView性能优化总结
一个加载网页的过程中，native、网络、后端处理、CPU都会参与，各自都有必要的工作和依赖关系；让他们相互并行处理而不是相互阻塞才可以让网页加载更快：

WebView初始化慢，可以在初始化同时先请求数据，让后端和网络不要闲着。

后端处理慢，可以让服务器分trunk输出，在后端计算的同时前端也加载网络静态资源。

脚本执行慢，就让脚本在最后运行，不阻塞页面解析。

同时，合理的预加载、预缓存可以让加载速度的瓶颈更小。

WebView初始化慢，就随时初始化好一个WebView待用。

DNS和链接慢，想办法复用客户端使用的域名和链接。

脚本执行慢，可以把框架代码拆分出来，在请求页面之前就执行好。


 
 
 
 
 
 
 
 
 

